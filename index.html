function guardarRanking() {
    const comercial = document.getElementById('comercialRanking').value;
    const fecha = document.getElementById('fechaRanking').value;
    const ventasTotal = parseFloat(document.getElementById('ventasTotalRanking').value);

    if (!comercial || !fecha || !ventasTotal) {
        alert("Por favor, complete todos los campos.");
        return;
    }

    const rankingTable = document.getElementById('rankingTable').getElementsByTagName('tbody')[0];
    const newRow = rankingTable.insertRow();

    newRow.insertCell(0).textContent = comercial;
    newRow.insertCell(1).textContent = fecha;
    newRow.insertCell(2).textContent = ventasTotal;

    document.getElementById('rankingForm').reset();

    ordenarRanking();
}

function ordenarRanking() {
    const rows = Array.from(document.getElementById('rankingTable').getElementsByTagName('tbody')[0].rows);
    rows.sort((a, b) => parseFloat(b.cells[2].textContent) - parseFloat(a.cells[2].textContent));
    const rankingTable = document.getElementById('rankingTable').getElementsByTagName('tbody')[0];
    rankingTable.innerHTML = "";
    rows.forEach(row => rankingTable.appendChild(row));
}

function exportarExcel() {
    let csvContent = "data:text/csv;charset=utf-8,";
    const rows = document.querySelectorAll("#rankingTable tr");

    rows.forEach(row => {
        const cols = Array.from(row.children).map(col => col.textContent);
        csvContent += cols.join(",") + "\n";
    });

    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "ranking_comercial.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Ajustar el formato de fecha al pegar, corrigiendo días/meses sin ceros iniciales
function ajustarFormatoFecha(inputField) {
    inputField.addEventListener("paste", (event) => {
        event.preventDefault(); // Evita el pegado directo
        const pastedData = (event.clipboardData || window.clipboardData).getData("text");

        // Detecta y transforma el formato D/M/YYYY, DD/MM/YYYY a YYYY-MM-DD
        const regex = /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/; // Acepta días y meses de 1 o 2 dígitos
        if (regex.test(pastedData)) {
            const parts = pastedData.match(regex);
            const day = parts[1].padStart(2, "0"); // Asegura 2 dígitos para el día
            const month = parts[2].padStart(2, "0"); // Asegura 2 dígitos para el mes
            const year = parts[3];
            const formattedDate = `${year}-${month}-${day}`; // Formato YYYY-MM-DD
            inputField.value = formattedDate;
        } else {
            alert("Por favor, pega una fecha en el formato D/M/YYYY o DD/MM/YYYY.");
        }
    });
}

// Llamar la función para el campo de fecha en el Ranking Comercial
ajustarFormatoFecha(document.getElementById("fechaRanking"));
